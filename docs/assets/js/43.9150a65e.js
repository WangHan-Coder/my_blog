(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{543:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("ul",[a("li",[s._v("DOM操作非常耗费性能（js操作比较快）")]),s._v(" "),a("li",[s._v("以前命令式的jquery可以自行控制操作DOM的时机，而对于声明式的靠数据驱动视图的vue和react，需要更加有效地控制DOM操作")]),s._v(" "),a("li",[s._v("由react首先提出，vue2.0开始采用，借鉴了"),a("a",{attrs:{href:"https://github.com/snabbdom/snabbdom",target:"_blank",rel:"noopener noreferrer"}},[s._v("snabbdom"),a("OutboundLink")],1),s._v("的实现，并添加了许多自己的特性")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("Vue")]),s._v("在"),a("code",[s._v("1.0")]),s._v("版本的时候是没有引入"),a("code",[s._v("虚拟DOM")]),s._v("，由于响应式系统的存在，"),a("code",[s._v("Vue")]),s._v("可以精确地知道具体哪些节点的状态发生了变化，从而对这些节点进行细粒度的"),a("code",[s._v("更新操作")]),s._v("，根本不需要比对。然而这种方式的缺陷在于要为每个节点创建一个"),a("code",[s._v("Watcher")]),s._v("，在项目复杂时，其"),a("code",[s._v("创建Watcher")]),s._v("的内存开销和进行"),a("code",[s._v("依赖追踪")]),s._v("的开销就会很大。"),a("br"),s._v("\n于是"),a("code",[s._v("Vue")]),s._v("在"),a("code",[s._v("2.0")]),s._v("版本时引入了"),a("code",[s._v("虚拟DOM")]),s._v("，将组件的更新粒度变为"),a("code",[s._v("中等粒度")]),s._v("，每一个组件对应一个"),a("code",[s._v("Watcher")]),s._v("，即使同一时间组件里的多个状态均发生变化，组件也只会"),a("code",[s._v("更新一次")]),s._v("。")])]),s._v(" "),a("h2",{attrs:{id:"解决方案-vdom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-vdom"}},[s._v("#")]),s._v(" 解决方案-vdom")]),s._v(" "),a("ul",[a("li",[s._v("有了一定的复杂度，想减少计算次数比较难")]),s._v(" "),a("li",[s._v("但可以把计算更多地转移为js计算，因为js执行速度很快")]),s._v(" "),a("li",[s._v("用js模拟DOM结构，计算出最小的变更，操作DOM")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'div1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        className"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'container'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            children"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vdom'")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ul'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                style"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    fontSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20px'")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            children"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'li'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    props"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    children"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                            text"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("h2",{attrs:{id:"vdom的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vdom的作用"}},[s._v("#")]),s._v(" vdom的作用")]),s._v(" "),a("ol",[a("li",[s._v("保证性能下限")]),s._v(" "),a("li",[s._v("跨平台")])]),s._v(" "),a("h2",{attrs:{id:"diff算法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff算法"}},[s._v("#")]),s._v(" diff算法")]),s._v(" "),a("h3",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("ul",[a("li",[s._v("diff算法是vdom中最核心、最关键的部分")]),s._v(" "),a("li",[s._v("diff算法能在日常使用vue react中体现出来（如key 随机数没用 每次重新渲染都是新的随机数）")]),s._v(" "),a("li",[s._v("diff即对比，是一个广泛的概念，如linux diff命令、git diff等")]),s._v(" "),a("li",[s._v("两个js对象也可以做diff")]),s._v(" "),a("li",[s._v("两棵树做diff，如vdom diff")])]),s._v(" "),a("h3",{attrs:{id:"树diff的时间复杂度是o-n-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#树diff的时间复杂度是o-n-3"}},[s._v("#")]),s._v(" 树diff的时间复杂度是O(n ^ 3)")]),s._v(" "),a("ul",[a("li",[s._v("第一遍历tree1，第二，遍历tree2，第三，排序")]),s._v(" "),a("li",[s._v("1000个节点，要计算1亿次，算法不可用")])]),s._v(" "),a("h3",{attrs:{id:"优化时间复杂度到o-n"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优化时间复杂度到o-n"}},[s._v("#")]),s._v(" 优化时间复杂度到O(n)")]),s._v(" "),a("ul",[a("li",[s._v("只比较同一层级，不跨级比较")]),s._v(" "),a("li",[s._v("tag不相同，则直接删掉重建，不再深度比较")]),s._v(" "),a("li",[s._v("tag和key，两者都相同，则认为是相同节点，不再深度比较")])]),s._v(" "),a("h3",{attrs:{id:"patch方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#patch方法"}},[s._v("#")]),s._v(" patch方法")]),s._v(" "),a("p",[s._v("patch方法是将vnode渲染成真实的DOM，它主要做三件事：")]),s._v(" "),a("ol",[a("li",[s._v("创建新增的节点")]),s._v(" "),a("li",[s._v("删除多余的节点")]),s._v(" "),a("li",[s._v("修改需要更新的节点")])]),s._v(" "),a("p",[s._v("比较策略：")]),s._v(" "),a("ul",[a("li",[s._v("vnode相同，走patchVnode")]),s._v(" "),a("li",[s._v("vnode不同，删除重建")])]),s._v(" "),a("h3",{attrs:{id:"diff算法总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#diff算法总结"}},[s._v("#")]),s._v(" diff算法总结")]),s._v(" "),a("ul",[a("li",[s._v("patchVnode")]),s._v(" "),a("li",[s._v("addVnodes removeVnodes")]),s._v(" "),a("li",[s._v("updateChildren(key的重要性)")])]),s._v(" "),a("h2",{attrs:{id:"vdom和diff总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vdom和diff总结"}},[s._v("#")]),s._v(" vdom和diff总结")]),s._v(" "),a("ul",[a("li",[s._v("vnode的核心概念：h、vnode、patch、diff、key等")]),s._v(" "),a("li",[s._v("vnode存在的价值：数据驱动视图，控制DOM操作")])])])}),[],!1,null,null,null);t.default=e.exports}}]);