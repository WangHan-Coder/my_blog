(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{455:function(s,t,n){"use strict";n.r(t);var a=n(1),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"一、dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、dockerfile"}},[s._v("#")]),s._v(" 一、Dockerfile")]),s._v(" "),t("p",[t("code",[s._v("Dockerfile")]),s._v(" 是docker的配置文件，文件名必须叫"),t("code",[s._v("Dockerfile")]),s._v("，而且必须放在项目根目录。")]),s._v(" "),t("h3",{attrs:{id:"_1-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-语法"}},[s._v("#")]),s._v(" 1. 语法")]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像 以哪个镜像作为基础去构建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:14")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 工作目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝文件 .表示当前目录下所有文件 但拷贝的时候会忽略 .dockerignore 文件里面定义的文件。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行一些命令 可以RUN多个")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" xxx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" xxx")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动容器时运行，只能有一个 CMD")]),s._v("\nCND xxx\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$M1")]),s._v(" && eche "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$C1")]),s._v(" && npm run dev && npx pm2 log # CMD最后一定要是一个阻塞控制台的程序 比如 npx pm2 log")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 环境变量")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" M1=N1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENV")]),s._v(" C1=D1")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h2",{attrs:{id:"二、docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、docker-compose"}},[s._v("#")]),s._v(" 二、Docker-compose")]),s._v(" "),t("p",[s._v("基于Docker和Docker-compose，通过一个配置文件，就可以让你的系统一键启动所有的运行环境：nodejs mysql mongodb redis")]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[s._v("一行命令即可安装")]),s._v(" "),t("h3",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),t("ul",[t("li",[s._v(".gitignore 需要增加 .docker-volumes/")])]),s._v(" "),t("div",{staticClass:"language-dockerfile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker-compose.yml")]),s._v("\nversion: '3'\nservices:\n\teditor-server: # service name\n\t\tbuild:\n\t\t\tcontext： . # 当前目录\n\t\t\tdockerfile: Dockerfile # 基于 Dockerfile 构建\n\t\timage: editor-server # 依赖于当前 Dockerfiles 创建出来的对象\n\t\tcontainer_name: editor-server\n\t\tports:\n\t\t\t- 8081:3000 # 宿主机通过 8081 访问\n\teditor-redis:\n\t\timage: redis #引用官网 redis 镜像\n\t\tcontainer_name: editor-redis\n\t\tports:\n\t\t\t- 6378:6379\n\t\tenvironment:\n\t\t\t- TZ=Asia/Shanghai # 设置时区\n\teditor-mysql\n\t\timage: mysql # 引用官网 mysql 镜像\n\t\tcontainer_name: editor-mysql\n\t\trestart: always # 出错则重启\n\t\tprivileged: true # 高权限，执行下面的 mysql/init\n\t\tcommand: --default-authentication-plugin=mysql_native_password # 远程访问\n\t\tvolumes:\n\t\t\t- '.docker-volumes/mysql/log:/var/log/mysql' # 记录日志\n\t\t\t- '.docker-volumes/mysql/data:/var/lib/mysql' # 数据持久化\n\t\t\t- './mysql/init:/docker-entrypoint-initdb.d/' # 初始化 sql\n\t\tenvironment:\n\t\t\t- MYSQL_DATABASE=imooc_lego_course # 初始化容器时创建数据库\n\t\t\t- MYSQL_ROOT_PASSWORD=Mysql_2019\n\t\t\t- TZ=Asia/Shanghai # 设置时区\n\teditor-mongo\n\t\timage: mongo # 引用官网 mongo 镜像\n\t\tcontainer_name: editor-mongo\n\t\trestart: always # 出错则重启\n\t\tvolumes:\n\t\t\t- '.docker-volumes/mongo/data:/data/db' # 数据持久化\n\t\tenvironment:\n\t\t\t- MONGO_INITDB_DATABASE=imooc_lego_course\n\t\t\t- TZ=Asia/Shanghai\n\t\tports:\n\t\t\t- '27016:27017'\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h3",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[s._v("#")]),s._v(" 命令")]),s._v(" "),t("ul",[t("li",[s._v("构建容器 docker-compose build "),t("service-name")],1),s._v(" "),t("li",[s._v("启动所有服务器 docker-compose up -d，后台启动")]),s._v(" "),t("li",[s._v("停止所有服务 docker-compose down")]),s._v(" "),t("li",[s._v("查看服务（查看 docker-compose中列举的服务） docker-compose ps")])])])}),[],!1,null,null,null);t.default=e.exports}}]);